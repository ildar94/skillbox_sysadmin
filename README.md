# skillbox_sysadmin
## Данный репозиторий является Финальной работой курса старт в системное администрирование

### Краткое описание проекта:
Данный проект нужен для разворачивания инфраструктуры компании "Рога и копыта". В нём находятся пакеты для подготовки серверов а также описание и документация.
> Сдесь представлены 4 сервера
>
> > Сервер OpenVPN
> 
> > Сервер Удостоверяющего центра
> 
> > Сервер сбора данных и оповещения
> 
> > Сервер локальный репозиторий deb пакетов + хранение нароботок.


### Требование к инфраструктуре:
Созданное облако в yandex cloud, операционная система ubuntu 20.04, один статический ip адрес.

### Необходимые программы и настройки для работы с проектом:
1. Необходимо установить yandex cloud CLI, для удоства работы
  - https://cloud.yandex.ru/docs/cli/quickstart
2. git
  - https://git-scm.com/book/ru/v2/%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-Git
3. Ниже инструкция как создать пару ssh ключей для доступа к ВМ
  - https://cloud.yandex.ru/docs/compute/operations/vm-connect/ssh#creating-ssh-keys

### Инструкция по разворачиванию проекта:
[Инструкция по развертыванию проекта ](Docs/Инструкция%20для%20системного%20администратора.docx)

### состав серверов проекта:
1. trust-center – Центр сертификации
2. ovpn-server – Сервер OpenVPN
3. data – локальный репозиторий deb пакетов и хранилище конфиг. Файлов
4. monitor – Prometheus + Grafana

### схема взаимодействия компонентов/серверов:
![image](https://github.com/ildar94/skillbox_sysadmin/assets/36185301/1037c7eb-d3fb-4227-a767-e8248aa77135)


### описание файлов и папок:
metadata.yaml - метеданные для создания виртуальных машин
1.  **Docs -инструкции:**
  - Инструкция для системного администратора.docx
  - конфигурация серверов.docx
  - инструкция для пользователя.docx
  - План развития инфраструктуры.docx
  - отказоустойчивость.txt
  - aptly.txt - разворачивание aptly сервера локльных deb репозиториев
  - ya_cloud_topology.drawio.pdf - схема серверов
2.   **all_deb** - директория с deb пакетами для удобного публикования во время конфигурации локально deb репозитория
  - iptables.sh - скрипт для конфигурации iptables на сервере data
  - grafana_10.1.2_amd64.deb - deb пакет для установки grafana на сервер monitor
  - monitoring_0.1-1_all.deb - deb пакет для установки и настройки prometheus на сервер monitor
  - easy-rsa-conf_0.1-1_all.deb -  deb пакет для установки и настройки easy-rsa  на сервер trust-center
  - config-ovpn_0.1-1_all.deb  deb пакет для установки и настройки easy-rsa,openvpn  на сервер ovpn-server
3. **easy-rsa**
  - easy-rsa-conf_0.1-1_all.deb - deb пакет для настройки сервера trust-center
  - easy-rsa-conf-0.1 - директория где лежат скрипты и файлы для создания этого пакета, на случай если потребуется пересобрать пакет с изменениями
4. **ovpn-server**
  - config-ovpn_0.1-1_all.deb - deb пакет для настройки сервера ovpn-server
  - v0.3.0.tar.gz - полный архив ovpn-exporter для prometheus
  - config-ovpn-0.1 иректория где лежат скрипты и файлы для создания этого пакета, на случай если потребуется пересобрать пакет с изменениями
5. **prometheus**
  - описание.txt - описание алертов
  - monitoring_0.1-1_all.deb - deb пакет для настройки сервера monitor
  - 1  OpenVPN Server_new.json - модифицированный dashboard для open-vpn сервиса
  - описание.txt - описание алертов



### Про особеность yandex cloud: 
В yandex cloud есть 3 зоны доступности: *ru-central-a*, *ru-central-b*, *ru-central-c*. Связь по tcp/ip между ниму аккумулируется через *network load balancer*.
Виртуальные машины находятся в сервисе *compute cloud*

В моей схеме 4 основных сервера расположены в зоне доступности *ru-central-a* и один запасной сервер dep repo в *ru-central-b*
Схема расположена сдесь https://drive.google.com/file/d/1Ueqj2GZxYHGoB1mm5_U_XnZF-v_hkinx/view?usp=sharing
https://drive.google.com/file/d/1U6dfylKBVkmAiTOZe4wus_GkSuKj1uHm/view?usp=sharing

#### Публичные ip адреса для всех серверов, кроме OpenVPN являются динамическими. Серверу OpenVPN назначен статичесий адрес 158.160.100.225
Общение между серверами происходит по hostname, чтобы не привязываться к ip адресам.

Для работы сервиса Yandex cloud-backup необходимо, чтобы релиз ubuntu был не выше 20.04 это важно

[Инструкция по развертыванию проекта ](Docs/Инструкция%20для%20системного%20администратора.docx)
[Инофрмация о серверах](Docs/конфигурация%20серверов.docx)

Чтобы изменить почту получателя алертов нужно поправить строчки в разделе smtp в файле /etc/grafana/grafana.ini.


